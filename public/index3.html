<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Panel â€“ Music App</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Inter,system-ui,sans-serif}

body{
  min-height:100vh;
  background:linear-gradient(135deg,#4f46e5,#9333ea);
  display:flex;
  align-items:center;
  justify-content:center;
}

.admin,.login{
  background:#fff;
  padding:30px;
  border-radius:20px;
  width:95%;
  max-width:1000px;
  box-shadow:0 30px 80px rgba(0,0,0,.3);
}

.login{max-width:400px}

h1{text-align:center;color:#4f46e5;margin-bottom:20px}

input,button{
  padding:12px;
  border-radius:10px;
  border:1px solid #ddd;
}

button{
  background:#4f46e5;
  color:#fff;
  border:none;
  cursor:pointer;
}

form{
  display:grid;
  grid-template-columns:1fr 1fr 1fr 1fr auto;
  gap:10px;
}

table{
  width:100%;
  margin-top:30px;
  border-collapse:collapse;
}

th,td{padding:12px;text-align:left}
th{background:#f3f4f6}
tr:nth-child(even){background:#f9fafb}

.cover{
  width:40px;
  height:40px;
  border-radius:6px;
  object-fit:cover;
}

.delete{background:#ef4444}
.logout{background:#111827;margin-top:20px}
.error{color:red;text-align:center;margin-top:10px}
</style>
</head>

<body>

<!-- LOGIN -->
<div class="login" id="loginBox">
  <h1>Admin Login</h1>
  <input id="user" placeholder="Username">
  <input id="pass" type="password" placeholder="Password">
  <button onclick="login()">Login</button>
  <div class="error" id="error"></div>
</div>

<!-- ADMIN -->
<div class="admin" id="adminBox" style="display:none">
  <h1>ðŸŽ§ Admin â€“ Songs, Covers & Analytics</h1>

  <!-- ADD SONG -->
  <form id="uploadForm">
  <input name="title" placeholder="Song Title">
  <input name="artist" placeholder="Artist">
  <input type="file" name="song" accept="audio/*">
  <input type="file" name="cover" accept="image/*">
  <button>Upload</button>
</form>

  <!-- SONG TABLE -->
  <table>
    <thead>
      <tr>
        <th>Cover</th>
        <th>Title</th>
        <th>Artist</th>
        <th>File</th>
        <th>Plays</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="list"></tbody>
  </table>

  <button class="logout" onclick="logout()">Logout</button>
</div>

<script>
/* DEFAULT ADMIN */
if(!localStorage.admin){
  localStorage.admin = JSON.stringify({
    user:"admin",
    pass:btoa("admin123")
  });
}

/* LOGIN */
function login(){
  const a = JSON.parse(localStorage.admin);
  if(user.value === a.user && btoa(pass.value) === a.pass){
    localStorage.loggedIn = "true";
    showAdmin();
  } else {
    error.textContent = "Invalid login";
  }
}

function logout(){
  localStorage.loggedIn = "";
  location.reload();
}

function showAdmin(){
  loginBox.style.display = "none";
  adminBox.style.display = "block";
  render();
}

if(localStorage.loggedIn === "true") showAdmin();

/* SONG DATA */
let songs = JSON.parse(localStorage.songs || "[]");

function save(){
  localStorage.songs = JSON.stringify(songs);
  render();
}

function addSong(e){
  e.preventDefault();
  const file = cover.files[0];
  const reader = new FileReader();

  reader.onload = () => {
    songs.push({
      title: title.value,
      artist: artist.value,
      src: src.value,      // MP3 filename
      cover: reader.result, // Base64 image
      plays: 0
    });
    e.target.reset();
    save();
  };

  reader.readAsDataURL(file);
}

function deleteSong(i){
  songs.splice(i,1);
  save();
}

function render(){
  list.innerHTML = "";
  songs.forEach((s,i)=>{
    list.innerHTML += `
      <tr>
        <td><img class="cover" src="${s.cover}"></td>
        <td>${s.title}</td>
        <td>${s.artist}</td>
        <td>${s.src}</td>
        <td>${s.plays || 0}</td>
        <td><button class="delete" onclick="deleteSong(${i})">Delete</button></td>
      </tr>
    `;
  });
}
document.getElementById("uploadForm").onsubmit = async e => {
  e.preventDefault();
  const fd = new FormData(e.target);
  await fetch("http://localhost:3000/upload", {
    method:"POST",
    body:fd
  });
  alert("Uploaded");
};
import { getStorage, ref, uploadBytes, getDownloadURL } from "firebase/storage";
import { addDoc, collection } from "firebase/firestore";

const storage = getStorage();

async function uploadSong(songFile, coverFile, title, artist) {
  const songRef = ref(storage, "songs/" + songFile.name);
  const coverRef = ref(storage, "covers/" + coverFile.name);

  await uploadBytes(songRef, songFile);
  await uploadBytes(coverRef, coverFile);

  const songURL = await getDownloadURL(songRef);
  const coverURL = await getDownloadURL(coverRef);

  await addDoc(collection(db,"songs"),{
    title, artist, src:songURL, cover:coverURL, plays:0
  });
}

</script>
<script src="script.js"></script>
</body>
</html>
