<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Genres – Music App</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="style.css">

<style>
/* extra styles for genres page */
.genres {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px,1fr));
  gap: 24px;
  margin-top: 30px;
}

.genre-card {
  background: linear-gradient(135deg,#a855f7,#ec4899);
  color: #fff;
  border-radius: 20px;
  padding: 18px;
}

.genre-card h3 {
  margin-bottom: 12px;
  font-size: 20px;
}

.genre-card ul {
  list-style: none;
}

.genre-card li {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 0;
}

.genre-card button {
  border: none;
  background: #fff;
  color: #6d28d9;
  width: 32px;
  height: 32px;
  border-radius: 50%;
  cursor: pointer;
}
</style>
</head>

<body>

<div class="app">

  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="profile">
      <div class="avatar"></div>
      <h3>Music App</h3>
    </div>

    <nav>
      <a href="index.html">Explore</a>
      <a class="active">Genres</a>
      <a href="#">Albums</a>
      <a href="#">Artist</a>
    </nav>
  </aside>

  <!-- MAIN -->
  <main class="main">
    <h1>Genres</h1>

    <div class="genres" id="genresBox"></div>
  </main>

  <!-- PLAYER -->
  <aside class="player">
    <h3 id="nowPlaying">No song</h3>
    <img id="coverImg" style="width:100%;border-radius:14px;margin:12px 0">
    <audio id="audio"></audio>

    <div class="controls">
      <button onclick="audio.currentTime=0">⏮</button>
      <button onclick="audio.paused ? audio.play() : audio.pause()">▶</button>
      <button onclick="audio.pause()">⏹</button>
    </div>
  </aside>

</div>

<script>
const genresBox = document.getElementById("genresBox");
const audio = document.getElementById("audio");
const nowPlaying = document.getElementById("nowPlaying");
const coverImg = document.getElementById("coverImg");

let songs = [];

/* FETCH SONGS FROM BACKEND */
fetch("/songs")
  .then(res => res.json())
  .then(data => {
    songs = data;
    renderGenres();
  });

function renderGenres(){
  const grouped = {};

  songs.forEach(song=>{
    const g = song.genre || "Other";
    if(!grouped[g]) grouped[g] = [];
    grouped[g].push(song);
  });

  genresBox.innerHTML = "";

  Object.keys(grouped).forEach(genre=>{
    const card = document.createElement("div");
    card.className = "genre-card";

    let list = "";
    grouped[genre].forEach(song=>{
      list += `
        <li>
          <span>${song.title}</span>
          <button onclick='playSong(${JSON.stringify(song)})'>▶</button>
        </li>
      `;
    });

    card.innerHTML = `
      <h3>${genre}</h3>
      <ul>${list}</ul>
    `;

    genresBox.appendChild(card);
  });
}

function playSong(song){
  audio.src = song.src;
  audio.play();
  nowPlaying.textContent = song.title + " • " + song.artist;
  if(song.cover) coverImg.src = song.cover;
}
</script>

</body>
</html>
